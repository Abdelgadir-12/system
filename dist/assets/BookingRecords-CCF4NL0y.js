import{c as L,v as B,r as d,j as e,h as E,t as T}from"./index-v6CNqsEH.js";import{T as D,a as _,b as x,c as l,d as R,e as o}from"./table-kUQv3v_S.js";import{I as b}from"./input-cEcEyZ5x.js";import{B as z}from"./badge-CT0QDU03.js";import{a as F}from"./appointmentDB-CWMaHyPF.js";import{S as J}from"./search-C8KJh43r.js";import{C as O}from"./clock-BzgeTgUr.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=L("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),q=()=>{const{toast:u}=B(),[p,N]=d.useState([]),[h,f]=d.useState(""),[j,k]=d.useState("all"),[g,y]=d.useState(""),[C,v]=d.useState(!0);d.useEffect(()=>{(async()=>{v(!0);try{console.log("🔍 Loading booking records using REST API (like Pets)...");const n="https://ztubrfjqsckplmelezws.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0dWJyZmpxc2NrcGxtZWxlendzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzMDQ5NjcsImV4cCI6MjA2NTg4MDk2N30.qyjJEwQKzk6t0tdSmRYZghBG1GMAE-2Y4g3obbwblr0",i=`${n}/rest/v1/appointments?select=*&order=appointment_date.desc`,t=await fetch(i,{headers:{apikey:c,Authorization:`Bearer ${c}`}});if(!t.ok)throw new Error(`Failed to fetch booking records: ${t.status} ${t.statusText}`);const a=await t.json();console.log("✅ REST API call succeeded:",a.length);const m=(a||[]).map(r=>({id:r.id,ownerName:r.owner_name,petName:r.pet_name,petSpecies:r.pet_species||"",service:r.service,date:r.appointment_date,time:r.time_slot,status:r.status,phone:r.phone||"",email:r.email||"",createdAt:r.created_at}));N(m)}catch(n){console.error("❌ REST API call failed:",n);try{console.log("🔄 Trying original method as fallback...");const i=(await F()||[]).map(t=>({id:t.id,ownerName:t.owner_name,petName:t.pet_name,petSpecies:t.pet_species||"",service:t.service,date:t.appointment_date,time:t.time_slot,status:t.status,phone:t.phone||"",email:t.email||"",createdAt:t.created_at}));N(i)}catch(c){console.error("Error loading appointments:",c),u({title:"Error",description:"Could not load booking records.",variant:"destructive"})}}finally{v(!1)}})()},[u]);const w=p.filter(s=>{var t,a,m,r,S;const n=(((t=s.ownerName)==null?void 0:t.toLowerCase())||"").includes(h.toLowerCase())||(((a=s.petName)==null?void 0:a.toLowerCase())||"").includes(h.toLowerCase())||(((m=s.service)==null?void 0:m.toLowerCase())||"").includes(h.toLowerCase())||(((r=s.id)==null?void 0:r.toLowerCase())||"").includes(h.toLowerCase()),c=j==="all"||(((S=s.status)==null?void 0:S.toLowerCase())||"")===j.toLowerCase(),i=!g||s.date===g;return n&&c&&i}),A=s=>{switch(s.toLowerCase()){case"completed":return"bg-green-500 text-white";case"scheduled":return"bg-blue-500 text-white";case"cancelled":return"bg-red-500 text-white";default:return"bg-gray-500 text-white"}},I=()=>{const s=w.map(a=>({"Booking ID":a.id,Customer:a.ownerName,Pet:a.petName,Service:a.service,Date:new Date(a.date).toLocaleDateString(),Time:a.time||a.timeSlot||"N/A",Status:a.status,Phone:a.phone||"N/A",Email:a.email||"N/A"})),n=[Object.keys(s[0]||{}).join(","),...s.map(a=>Object.values(a).join(","))].join(`
`),c=new Blob([n],{type:"text/csv"}),i=window.URL.createObjectURL(c),t=document.createElement("a");t.href=i,t.download=`booking-records-${new Date().toISOString().split("T")[0]}.csv`,t.click(),window.URL.revokeObjectURL(i),u({title:"Export Successful",description:"Booking records have been exported to CSV."})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Booking Records"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(b,{type:"text",placeholder:"Search bookings...",className:"pl-10 pr-4 py-2",value:h,onChange:s=>f(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(b,{type:"date",className:"w-auto",value:g,onChange:s=>y(s.target.value)})]}),e.jsxs("select",{className:"px-3 py-2 border rounded-md dark:bg-gray-800 dark:border-gray-700 dark:text-white",value:j,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs(T,{onClick:I,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Export CSV"]})]}),e.jsx("div",{className:"border rounded-md dark:border-gray-700",children:e.jsxs(D,{children:[e.jsx(_,{children:e.jsxs(x,{children:[e.jsx(l,{children:"Booking ID"}),e.jsx(l,{children:"Customer"}),e.jsx(l,{children:"Pet"}),e.jsx(l,{children:"Species"}),e.jsx(l,{children:"Service"}),e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Time"}),e.jsx(l,{children:"Contact"}),e.jsx(l,{children:"Status"})]})}),e.jsx(R,{children:C?e.jsx(x,{children:e.jsx(o,{colSpan:9,className:"text-center py-8",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(O,{className:"animate-spin h-4 w-4 mr-2"}),"Loading booking records..."]})})}):w.length>0?w.slice().reverse().map(s=>e.jsxs(x,{children:[e.jsx(o,{className:"font-medium",children:s.id}),e.jsx(o,{children:s.ownerName}),e.jsx(o,{children:s.petName}),e.jsx(o,{className:"capitalize",children:s.petSpecies}),e.jsx(o,{className:"capitalize",children:s.service}),e.jsx(o,{children:new Date(s.date).toLocaleDateString()}),e.jsx(o,{children:s.time||s.timeSlot||"N/A"}),e.jsx(o,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:s.phone||"N/A"}),e.jsx("div",{className:"text-muted-foreground text-xs",children:s.email||"N/A"})]})}),e.jsx(o,{children:e.jsx(z,{className:A(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})})]},s.id)):e.jsx(x,{children:e.jsx(o,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"No booking records found"})})})]})})]})};export{q as default};
