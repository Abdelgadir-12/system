import{v as k,r as o,j as e}from"./index-v6CNqsEH.js";import{g as $,d as F,u as P,a as T}from"./usersDBsupabase-YspMKCDw.js";const z=()=>{const{toast:r}=k(),[p,g]=o.useState([]),[i,N]=o.useState(""),[d,w]=o.useState("All"),[c,A]=o.useState("All"),[y,m]=o.useState(!0);o.useEffect(()=>{(async()=>{try{m(!0),console.log("🔍 Loading users using REST API (like Pets)...");const s="https://ztubrfjqsckplmelezws.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0dWJyZmpxc2NrcGxtZWxlendzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzMDQ5NjcsImV4cCI6MjA2NTg4MDk2N30.qyjJEwQKzk6t0tdSmRYZghBG1GMAE-2Y4g3obbwblr0",l=`${s}/rest/v1/profiles?select=*&order=created_at.desc`,n=await fetch(l,{headers:{apikey:a,Authorization:`Bearer ${a}`}});if(!n.ok)throw new Error(`Failed to fetch users: ${n.status} ${n.statusText}`);const x=await n.json();console.log("✅ Users REST API call succeeded:",x.length),g(x)}catch(s){console.error("❌ REST API call failed:",s);try{console.log("🔄 Trying original method as fallback...");const a=await $();g(a)}catch(a){console.error("❌ Original method failed:",a)}}finally{m(!1)}})()},[]);const u=async()=>{try{m(!0),console.log("🔍 Loading users from localStorage...");const t=getUsers();console.log("✅ Loaded users:",t.length),g(t)}catch(t){console.error("❌ Error loading users:",t),r({title:"Error",description:"Failed to load users data. Please try again.",variant:"destructive"})}finally{m(!1)}},S=()=>{u()},C=async(t,s)=>{if(window.confirm(`Are you sure you want to delete ${s}? This action cannot be undone.`))try{await F(t),r({title:"User Deleted",description:`${s} has been removed from the system.`}),u()}catch(a){console.error("❌ Error deleting user:",a),r({title:"Error",description:"Failed to delete user. Please try again.",variant:"destructive"})}},U=async(t,s,a)=>{try{await P(t,a),r({title:"Status Updated",description:`${s}'s status has been updated to ${a}.`}),u()}catch(l){console.error("❌ Error updating user status:",l),r({title:"Error",description:"Failed to update user status. Please try again.",variant:"destructive"})}},I=async(t,s,a)=>{try{await T(t,a),r({title:"Role Updated",description:`${s}'s role has been updated to ${a}.`}),u()}catch(l){console.error("❌ Error updating user role:",l),r({title:"Error",description:"Failed to update user role. Please try again.",variant:"destructive"})}},f=()=>{r({title:"Add User",description:"Add user functionality will be implemented soon."})},E=t=>{r({title:"Edit User",description:`Edit functionality for ${t.name} will be implemented soon.`})},h=p.filter(t=>{var n,x,j,v,b;const s=((n=t.name)==null?void 0:n.toLowerCase().includes(i.toLowerCase()))||((x=t.email)==null?void 0:x.toLowerCase().includes(i.toLowerCase()))||((j=t.id)==null?void 0:j.toLowerCase().includes(i.toLowerCase())),a=d==="All"||((v=t.role)==null?void 0:v.toLowerCase())===d.toLowerCase(),l=c==="All"||((b=t.status)==null?void 0:b.toLowerCase())===c.toLowerCase();return s&&a&&l}),L=t=>{switch(t){case"Active":return"bg-green-100 text-green-800";case"Inactive":return"bg-gray-100 text-gray-800";case"Suspended":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},R=t=>{switch(t){case"Admin":return"bg-purple-100 text-purple-800";case"Veterinarian":return"bg-blue-100 text-blue-800";case"Staff":return"bg-orange-100 text-orange-800";case"Client":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"User Management"}),e.jsxs("div",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-medium",children:["👥 ",p.length," Users"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm",children:"➕ Add User"}),e.jsx("button",{onClick:S,disabled:y,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 text-sm",children:"🔄 Refresh"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx("input",{type:"text",placeholder:"Search users by name, email, phone, or ID...",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:i,onChange:t=>N(t.target.value)})}),e.jsxs("select",{className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:d,onChange:t=>w(t.target.value),children:[e.jsx("option",{value:"All",children:"All Roles"}),e.jsx("option",{value:"Client",children:"Clients"}),e.jsx("option",{value:"Veterinarian",children:"Veterinarians"}),e.jsx("option",{value:"Admin",children:"Admins"}),e.jsx("option",{value:"Staff",children:"Staff"})]}),e.jsxs("select",{className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:c,onChange:t=>A(t.target.value),children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"}),e.jsx("option",{value:"Suspended",children:"Suspended"})]})]}),e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Joined On"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:y?Array.from({length:5}).map((t,s)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-16"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-24"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-32"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-16"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-12"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-20"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-16"})})]},s)):h.length>0?h.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:t.id}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.name}),t.address&&e.jsx("div",{className:"text-xs text-gray-500",children:t.address})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.phone}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:t.role,onChange:s=>I(t.id,t.name,s.target.value),className:`px-2 py-1 rounded-full text-xs font-medium border-0 ${R(t.role)}`,children:[e.jsx("option",{value:"Client",children:"Client"}),e.jsx("option",{value:"Veterinarian",children:"Veterinarian"}),e.jsx("option",{value:"Staff",children:"Staff"}),e.jsx("option",{value:"Admin",children:"Admin"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:t.status,onChange:s=>U(t.id,t.name,s.target.value),className:`px-2 py-1 rounded-full text-xs font-medium border-0 ${L(t.status)}`,children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"}),e.jsx("option",{value:"Suspended",children:"Suspended"})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.joinedOn}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>E(t),className:"text-blue-600 hover:text-blue-800 text-sm",children:"✏️"}),e.jsx("button",{onClick:()=>C(t.id,t.name),className:"text-red-600 hover:text-red-800 text-sm",children:"🗑️"})]})})]},t.id)):e.jsx("tr",{className:"border-t",children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"text-4xl",children:"👥"}),e.jsx("div",{className:"text-gray-500",children:i||d!=="All"||c!=="All"?"No users match your search criteria":"No users found in the system"}),!i&&d==="All"&&c==="All"&&e.jsx("button",{onClick:f,className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"➕ Add Your First User"})]})})})})]})}),!y&&h.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["Showing ",h.length," of ",p.length," users"]})]})};export{z as default};
