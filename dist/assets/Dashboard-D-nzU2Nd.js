import{c as S,r as A,h as v,j as e,C as w,x as N,y as I,a as b,t as E}from"./index-v6CNqsEH.js";import{a as k}from"./appointmentDB-CWMaHyPF.js";import{P as z}from"./paw-print-BUegN35H.js";import{U as D,R as P}from"./users-C9HfqGWJ.js";import{C as R}from"./clock-BzgeTgUr.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=S("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=S("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),_=async()=>{try{console.log("ðŸ” Loading admin stats using REST API (like Pets)...");const l="https://ztubrfjqsckplmelezws.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0dWJyZmpxc2NrcGxtZWxlendzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzMDQ5NjcsImV4cCI6MjA2NTg4MDk2N30.qyjJEwQKzk6t0tdSmRYZghBG1GMAE-2Y4g3obbwblr0",i=`${l}/rest/v1/appointments?select=*`,p=await fetch(i,{headers:{apikey:r,Authorization:`Bearer ${r}`}});let o=[];p.ok?(o=await p.json(),console.log("âœ… Appointments REST API call succeeded:",o.length)):console.error("Error fetching appointments for admin stats:",p.statusText);const x=`${l}/rest/v1/pets?select=*`,d=await fetch(x,{headers:{apikey:r,Authorization:`Bearer ${r}`}});let m=[];d.ok?(m=await d.json(),console.log("âœ… Pets REST API call succeeded:",m.length)):console.error("Error fetching pets for admin stats:",d.statusText);const h=new Set;o.forEach(n=>{n.owner_id?h.add(n.owner_id):n.email&&h.add(n.email)});const t=o.filter(n=>{var s;return((s=n.status)==null?void 0:s.toLowerCase())==="scheduled"}).length,c=o.filter(n=>{var s;return((s=n.status)==null?void 0:s.toLowerCase())==="completed"}).length,a=o.filter(n=>{var s;return((s=n.status)==null?void 0:s.toLowerCase())==="cancelled"}).length;return{totalAppointments:o.length,totalPets:m.length,activeClients:h.size,scheduledAppointments:t,completedAppointments:c,cancelledAppointments:a}}catch(l){return console.error("Error calculating admin stats:",l),{totalAppointments:0,totalPets:0,activeClients:0,scheduledAppointments:0,completedAppointments:0,cancelledAppointments:0}}},G=()=>{const[l,r]=A.useState([]),[i,p]=A.useState({totalAppointments:0,totalPets:0,activeClients:0,scheduledAppointments:0,completedAppointments:0,cancelledAppointments:0}),[o,x]=A.useState(!0),d=async()=>{try{x(!0);const t=await _();p(t)}catch(t){console.error("Error loading admin stats:",t)}finally{x(!1)}};A.useEffect(()=>{d(),(async()=>{try{console.log("ðŸ” Loading next appointments using REST API (like Pets)...");const c="https://ztubrfjqsckplmelezws.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0dWJyZmpxc2NrcGxtZWxlendzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzMDQ5NjcsImV4cCI6MjA2NTg4MDk2N30.qyjJEwQKzk6t0tdSmRYZghBG1GMAE-2Y4g3obbwblr0",n=`${c}/rest/v1/appointments?select=*&order=appointment_date.asc`,s=await fetch(n,{headers:{apikey:a,Authorization:`Bearer ${a}`}});if(!s.ok)throw new Error(`Failed to fetch appointments: ${s.status} ${s.statusText}`);const g=await s.json();console.log("âœ… REST API call succeeded:",g.length);const f=new Date,y=g.filter(j=>{const u=(j.status||"").toLowerCase();if(u==="cancelled"||u==="completed")return!1;const C=(new Date(j.appointment_date).getTime()-f.getTime())/(1e3*3600);return C>0&&C<=24});r(y)}catch(c){console.error("âŒ REST API call failed:",c);try{console.log("ðŸ”„ Trying original method as fallback...");const a=await k(),n=new Date,s=a.filter(g=>{const f=(g.status||"").toLowerCase();if(f==="cancelled"||f==="completed")return!1;const u=(new Date(g.appointment_date).getTime()-n.getTime())/(1e3*3600);return u>0&&u<=24});r(s)}catch(a){console.error("Error loading next appointments:",a)}}})()},[]);const m=()=>{d()},h=[{title:"Total Appointments",value:i.totalAppointments.toString(),icon:v,color:"bg-blue-500"},{title:"Registered Pets",value:i.totalPets.toString(),icon:z,color:"bg-green-500"},{title:"Active Clients",value:i.activeClients.toString(),icon:D,color:"bg-orange-500"},{title:"Scheduled Appointments",value:i.scheduledAppointments.toString(),icon:R,color:"bg-yellow-500"},{title:"Completed Appointments",value:i.completedAppointments.toString(),icon:T,color:"bg-green-600"},{title:"Cancelled Appointments",value:i.cancelledAppointments.toString(),icon:J,color:"bg-red-500"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"mt-6",children:e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(I,{children:"Upcoming Appointments (Next 24 Hours)"})}),e.jsx(b,{children:l.length===0?e.jsx("div",{className:"text-muted-foreground",children:"No upcoming appointments."}):e.jsx("ul",{className:"space-y-2",children:l.map(t=>e.jsxs("li",{className:"border-b pb-2",children:[e.jsx("strong",{children:t.pet_name})," with ",e.jsx("strong",{children:t.owner_name})," for ",e.jsx("strong",{children:t.service})," on ",e.jsx("strong",{children:t.appointment_date})," at ",e.jsx("strong",{children:t.time_slot})]},t.id))})})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Dashboard"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(E,{onClick:m,disabled:o,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(P,{className:`h-4 w-4 ${o?"animate-spin":""}`}),"Refresh"]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:o?Array.from({length:6}).map((t,c)=>e.jsxs(w,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-24"}),e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded-full animate-pulse"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-16 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-32"})]})]},c)):h.map(t=>e.jsxs(w,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(I,{className:"text-sm font-medium",children:t.title}),e.jsx("div",{className:`${t.color} p-2 rounded-full text-white`,children:e.jsx(t.icon,{size:16})})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.value}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Real-time data"})]})]},t.title))})]})};export{G as default};
